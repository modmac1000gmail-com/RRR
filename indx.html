<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نور الإيمان | مواقيت الصلاة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0b4b3e;
            --secondary: #148972;
            --accent: #FFB300;
            --dark: #1A1A1A;
            --light: #F5F5F5;
            --white: #FFFFFF;
            --gradient: linear-gradient(135deg, #0B4B3D, #148972);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
        }

        .header {
            background: var(--gradient);
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
        }

        .prayer-times {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1200px;
            margin: 100px auto 0;
        }

        .location-info {
            background: var(--white);
            border-radius: 20px;
            padding: 1rem 2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .location-info i {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .prayer-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .prayer-item {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .prayer-item:hover {
            transform: translateY(-5px);
        }

        .prayer-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .prayer-time {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--secondary);
        }

        .next-prayer {
            background: var(--gradient);
            color: var(--white);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .next-prayer h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .countdown {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--accent);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            font-size: 1.2rem;
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .prayer-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-links {
                display: none;
            }

            .next-prayer {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
        }

        @media (max-width: 480px) {
            .prayer-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <div class="logo">
                <i class="fas fa-mosque"></i>
                نور الإيمان
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link">مواقيت الصلاة</a>
                <a href="#" class="nav-link">القرآن الكريم</a>
                <a href="#" class="nav-link">الأذكار</a>
                <a href="#" class="nav-link">المساجد القريبة</a>
                <a href="#" class="nav-link"البوصلة
    </a>
            </div>
        </nav>
    </header>

    <main class="prayer-times">
        <div class="location-info">
            <i class="fas fa-location-dot"></i>
            <span id="location-text">جاري تحديد موقعك...</span>
        </div>

        <div class="next-prayer">
            <div>
                <h2>الصلاة القادمة: <span id="next-prayer-name">جاري التحميل...</span></h2>
                <p>متبقي على الأذان</p>
            </div>
            <div class="countdown" id="countdown">--:--:--</div>
        </div>

        <div class="prayer-card">
            <h2>مواقيت الصلاة اليوم</h2>
            <div class="prayer-grid">
                <div class="prayer-item" data-prayer="Fajr">
                    <div class="prayer-name">الفجر</div>
                    <div class="prayer-time">--:--</div>
                </div>
                <div class="prayer-item" data-prayer="Dhuhr">
                    <div class="prayer-name">الظهر</div>
                    <div class="prayer-time">--:--</div>
                </div>
                <div class="prayer-item" data-prayer="Asr">
                    <div class="prayer-name">العصر</div>
                    <div class="prayer-time">--:--</div>
                </div>
                <div class="prayer-item" data-prayer="Maghrib">
                    <div class="prayer-name">المغرب</div>
                    <div class="prayer-time">--:--</div>
                </div>
                <div class="prayer-item" data-prayer="Isha">
                    <div class="prayer-name">العشاء</div>
                    <div class="prayer-time">--:--</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // تحويل اسماء الصلوات إلى العربية
        const prayerNames = {
            'Fajr': 'الفجر',
            'Dhuhr': 'الظهر',
            'Asr': 'العصر',
            'Maghrib': 'المغرب',
            'Isha': 'العشاء'
        };

        // دالة للحصول على الموقع الجغرافي
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getPrayerTimes, handleLocationError);
            } else {
                alert("المتصفح لا يدعم تحديد الموقع");
            }
        }

        // دالة معالجة خطأ تحديد الموقع
        function handleLocationError(error) {
            let errorMessage = "حدث خطأ في تحديد الموقع: ";
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += "تم رفض الوصول للموقع.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += "معلومات الموقع غير متوفرة.";
                    break;
                case error.TIMEOUT:
                    errorMessage += "انتهت مهلة طلب الموقع.";
                    break;
                default:
                    errorMessage += "حدث خطأ غير معروف.";
                    break;
            }
            alert(errorMessage);
        }

        // دالة للحصول على مواقيت الصلاة
        async function getPrayerTimes(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const date = new Date();
            
            try {
                // الحصول على اسم المدينة
                const locationResponse = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=ar`);
                const locationData = await locationResponse.json();
                document.getElementById('location-text').textContent = `${locationData.city}, ${locationData.countryName}`;

                // الحصول على مواقيت الصلاة
                const response = await fetch(`https://api.aladhan.com/v1/timings/${date.getDate()}-${date.getMonth() + 1}-${date.getFullYear()}?latitude=${latitude}&longitude=${longitude}&method=4`);
                const data = await response.json();
                
                updatePrayerTimes(data.data.timings);
                startNextPrayerCountdown(data.data.timings);
            } catch (error) {
                console.error('Error:', error);
                alert('حدث خطأ في جلب مواقيت الصلاة');
            }
        }

        // دالة لتحديث مواقيت الصلاة في الصفحة
        function updatePrayerTimes(timings) {
            Object.keys(prayerNames).forEach(prayer => {
                const element = document.querySelector(`[data-prayer="${prayer}"] .prayer-time`);
                if (element) {
                    element.textContent = timings[prayer];
                }
            });
        }

        // دالة لحساب الصلاة القادمة والوقت المتبقي
        function startNextPrayerCountdown(timings) {
            function updateCountdown() {
                const now = new Date();
                let nextPrayer = null;
                let nextPrayerTime = null;

                // تحويل الأوقات إلى كائنات Date
                for (let prayer in prayerNames) {
                    const [hours, minutes] = timings[prayer].split(':');
                    const prayerTime = new Date();
                    prayerTime.setHours(hours, minutes, 0);

                    if (prayerTime > now) {
                        if (!nextPrayerTime || prayerTime < nextPrayerTime) {
                            nextPrayer = prayer;
                            nextPrayerTime = prayerTime;
                        }
                    }
                }

                // إذا لم نجد صلاة قادمة، نفترض أن الصلاة القادمة هي فجر اليوم التالي
                if (!nextPrayer) {
                    nextPrayer = 'Fajr';
                    const [hours, minutes] = timings.Fajr.split(':');
                    nextPrayerTime = new Date();
                    nextPrayerTime.setDate(nextPrayerTime.getDate() + 1);
                    nextPrayerTime.setHours(hours, minutes, 0);
                }

                // حساب الوقت المتبقي
                const diff = nextPrayerTime - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                // تحديث العرض
                document.getElementById('next-prayer-name').textContent = prayerNames[nextPrayer];
                document.getElementById('countdown').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            // تحديث العد التنازلي كل ثانية
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // تشغيل عند تحميل الصفحة
        window.onload = getLocation;
    </script>
</body>
</html>
